I""<p>통계적 가설 검정에서 <strong>다중 검정 (Multiple Testing)</strong> 이란, 특정한 하나의 실험에서 여러번의 가설 검정을 동시에 수행하는 경우를 의미한다.</p>

<p>비록 여러번의 가설 검정을 수행하는 것 자체는 문제가 되지 않으나, 도출된 결과의 해석에 있어서 <strong>다중 검정은 1종 오류 (Type 1 error) 를 의도했던 유의수준보다 증가시킬 수 있다는 점에서 상당한 주의가 필요하다</strong>. 이러한 맥락에서, 해당 포스트에서는 다중 검정의 전체적인 개념을 소개한 다음, 이를 처리할 수 있는 통계적 방법론 몇가지를 살펴보도록 하겠다.</p>

<p> </p>

<hr />

<h2 id="1-다중-검정이-문제가-되는-이유">1. 다중 검정이 문제가 되는 이유</h2>

<p>일반적인 통계적 가설 검정 문제를 생각해보자. 특정한 한 번의 가설 검정 (i.e. 단일 검정) 절차에서 우리가 잘못된 결론을 내릴 확률, 즉 <strong>1종 오류</strong>는 유의수준 $\alpha$ 이하로 보장된다는 사실은 자명하다.</p>

<p>한편, 이러한 가설 검정 절차를 총 $m$ 번 반복한다고 가정해보자. 이 때, i-번째 귀무가설을 $H_{0i}$ 라고 정의할 경우, 전체 $m$ 개의 가설 검정 중에서 <strong>적어도 한 개 이상의 가설에 대해서 잘못된 결론을 내릴 확률</strong> (i.e. <strong>family-wise type I error</strong>) 은 역확률의 정의에 의해 다음과 같이 구해진다.</p>

<center>

$$
\begin{aligned}
P\Big(\text{at least one }H_{0i} \text{ is False} \;|\; H_{0i} \text{ is True} \Big) &amp;= 1 - P\Big(\text{all least one }H_{0i} \text{ is True} \;|\; H_{0i} \text{ is True} \Big) \\[10pt]
&amp;= 1 - (1-\alpha)^m
\end{aligned}
$$

</center>

<p> </p>

<p>이를 바탕으로 가설 검정의 개수 ($m$) 에 따른 family-wise type I error의 함수를 그래프를 다음과 같이 그릴 수 있다.</p>

<center>
  <img src="/images/abtest/11.png" width="600" height="450" /> 
 <br />
 <em><span style="color:grey"></span></em>
</center>

<p> </p>

<p>여기서 주목해야 할 점은 바로 가설 검정의 개수 $m$에 대한 family-wise type I error의 함수가 <strong>“단조증가함수”</strong>라는 점이다. 즉, 수행되는 검정이 많아지면 많아질수록 전체적으로 1종 오류가 발생할 확률 역시 점점 커진다.</p>

<p>따라서 만약 특정한 하나의 실험에서 여러 지표에 대한 가설 검정을 10번 정도만 수행할 경우, 적어도 한개 이상의 가설에 대해 잘못된 결론을 내릴 확률이 거의 <strong>40%</strong>에 육박하게 된다. 이것이 바로 다중 검정의 치명적인 문제점이라고 할 수 있다. 그리고 이는 빈도주의 가설 검정 절차의 가장 핵심적인 특징이자 장점이라고 할 수 있는 1종 오류 통제의 측면에서 실험의 결과 자체에 대한 신뢰성를 떨어뜨릴 수 있기 때문에 각별한 주의가 필요하다.</p>

<p>이처럼 다중 검정의 문제점은 위와 같이 수학적으로 증명이 된 사실이지만, 직관적인 측면에서 다중 검정의 의미를 이해하는 것은 실험을 기획하고 결과를 해석하는 분석가의 입장에서 상당히 중요하기 때문에 구체적인 예시를 바탕으로 다시 한번 살펴보도록 하겠다.</p>

<p> </p>

<h4 id="몬티-홀-문제-monty-hall-problem">몬티 홀 문제 (Monty Hall Problem)</h4>

<p><a href="https://ko.wikipedia.org/wiki/몬티_홀_문제">몬티 홀 문제</a>란 총 3개의 문 중에 하나를 선택한 다음, 그 문 뒤에 있는 경품을 가져가는 미국의 TV쇼에서 진행된 게임을 의미한다.</p>

<p>게임의 참가자에게는 문을 선택할 기회가 <strong>단 한번만</strong> 주어지며, 세개의 문 중 하나의 문 뒤에는 스포츠카가 있다.</p>

<center>
  <img src="/images/abtest/12.png" width="500" height="400" /> 
 <br />
 <em><span style="color:grey">몬티 홀 문제</span></em>
</center>

<p> </p>

<p>사실 몬티 홀 문제는 베이즈 정리를 이용한 조건부 확률의 개념을 설명할 때 흔하게 쓰이는 예시인데, 해당 포스트에서는 이러한 몬티 홀 문제의 상황을 약간 응용해서 앞서 3개의 문이 있었던 것을 <strong>20개</strong>로 늘려보도록 하겠다.</p>

<center>
  <img src="/images/abtest/13.png" width="500" height="400" /> 
 <br />
 <em><span style="color:grey"></span></em>
</center>

<p> </p>

<p>위와 같이 총 20개의 문이 있고, 그 중에서 단 하나의 문 뒤에만 경품인 스포츠카가 있다고 가정한다. 이 상황에서 게임의 참가자가 <strong>스포츠카에 당첨될 확률</strong>은 $\frac{1}{20} = 0.05$, 즉 <strong>5%</strong> 이다.</p>

<p>이제 어떤 참가자 A가 있다고 해보자. 애석하게도, A는 앞서 그에게 주어진 기회에서 꽝인 문을 선택해서 경품을 받지 못했다. 하지만 그는 경품의 위치를 재배정한 다음에 본인에게 한번만 더 기회를 달라고 호소하고 있다. 그는 “어차피 당첨 확률은 5%로 동일하기 때문에 한번의 기회가 더 주어지더라도 별 상관없지 않냐” 라는 주장을 하고 있다.</p>

<p>이러한 그의 주장은 한눈에 봐도 엉터리임이 자명하다. 비록 경품의 위치가 재배정되었다고 하더라도, 만약 A에게 문을 선택할 기회가 두번 주어진다면 그 중에 한 번이라도 경품에 당첨될 확률이 올라갈 것이라는 것은 상식적으로 너무나도 당연하기 때문이다.</p>

<p>실제로 단 한번의 게임에서 A가 경품을 탈 확률은 5%이지만, 만약 문 선택의 기회가 <strong>두번 주어진다면</strong> 경품을 탈 확률은 더이상 5%가 아니며, 앞서 확인했듯이 이는 $1 - (1-0.05)^2$ 로 거의 두배인 <strong>9.75%</strong> 가 된다.</p>

<p> </p>

<p>이제 다시 다중 검정의 내용으로 돌아가보도록 하자. 다중 검정에서 <strong>“한번의 가설 검정을 수행하는 것”</strong>은 위 예시에서 <strong>“문을 한번 선택하는 것”</strong>과 일맥상통한다. 그리고 위 예시에서 <strong>“경품이 포함된 문”</strong>은 통계적 가설 검정에서의 <strong>“1종 오류”</strong>에 대응된다.</p>

<p>애당초 A/B Test 를 진행하는 이유는 대부분의 경우 실험하고자 하는 기능에 대한 통계적 유의성을 주장하기 위함이다. 그리고 이를 위해 통계적 가설 검정을 활용하게 되는데, 당연하게도 우리는 언제나 유의수준 $\alpha$ (일반적으로 5%) 만큼의 확률로 <strong>“잘못된”</strong> 결과를 도출할 리스크를 안고 있다. 따라서 만약 앞선 예시처럼 문을 선택하는 과정을 여러번 반복하는 경우, 우연에 의해서 당첨이 될 확률이 증가해서 <strong>1종 오류</strong>에 빠지게 될 위험이 커지게 된다. 이는 결과적으로 실험의 안정성을 우리가 사전에 고려한 수준으로 보장할 수가 없게 되는 것이다.</p>

<p> </p>

<p>사실 다중 검정은 통계학을 전공하지 않은 사람들에게는 매우 생소한 개념일 수 있어, 많은 경우 가설 검정을 여러번 하는 것이 문제가 된다는 사실 자체를 인지하지 못하는 상황이 발생할 수 있다.</p>

<p>그렇다면 실제로 어떤 상황에서 다중 검정 문제가 발생하는지를 구체적인 예시를 통해서 살펴보도록 하겠다. 가령, 어떠한 실험에서 다음과 같이 지표들이 설정되었다고 가정해보겠습니다.</p>

<ul>
  <li>primary metric: <strong>“세션당 클릭수”</strong></li>
  <li>secondary metric: <strong>“세션당 체류시간”, “세션당 페이지뷰”</strong></li>
</ul>

<p>해당 실험의 결과로 primary metric인 세션당 클릭수에 대해서 p-value가 0.14로 유의하지 않은 결과가 나왔습니다. 한편, 추가적인 가설 검정을 진행해보니 두개의 secondary metric에 대해서는 p-value가 각각 0.039, 0.042 로 유의하게 나왔습니다. (유의수준 = 0.05)</p>

<p>이러한 상황에서, “새로운 기능은 <strong>클릭수 개선에는 효과가 없으나</strong>, <strong>체류시간과 페이지뷰를 개선하는 효과가 있다</strong>“라고 주장할 수 있을까요? 아쉽지만, 앞서 살펴본 다중 검정의 문제점 때문에 위 결론은 통계적으로 타당하지 않습니다.</p>

<hr />

<p> </p>

<p>&lt;/center&gt;</p>

<p> </p>

<hr />

<h1 id="reference">Reference</h1>

<ul>
  <li>Casella, G., &amp; Berger, R. L. (2002). <em>Statistical inference.</em> 2nd ed. Australia ; Pacific Grove, CA: Thomson Learning.</li>
</ul>

:ET