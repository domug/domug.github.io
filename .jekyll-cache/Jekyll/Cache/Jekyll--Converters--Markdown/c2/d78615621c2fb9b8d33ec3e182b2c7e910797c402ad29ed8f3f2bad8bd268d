I"Z#<p>해당 포스트에서는 <strong>베이지안 방법론</strong>을 사용하도록 설계된 A/B Test에 대한 개괄적인 내용과 전통적인 빈도주의 (frequentist) 방식에 비해 베이지안 방법론이 갖는 몇가지 특징들을 정리해볼 예정이다.</p>

<p> </p>

<h1 id="1-베이지안-ab-test란">1. 베이지안 A/B Test란?</h1>

<p>베이지안 방법론의 가장 핵심적인 아이디어는 추정하고자 하는 <strong>모수 (parameter) 를 확률 변수라고 생각하는 것</strong>이다.</p>

<p>이와 관련해, <strong>빈도주의</strong> <strong>통계학</strong>에서 <strong>p-value</strong>가 계산되는 로직을 잠깐 생각해보자면, 이는 “<strong>특정한 한 번의 시점</strong>“에서 관측된 데이터가 이론적인 확률 분포로부터 얼마나 그럴싸 한 값인지를 확률값으로 나타낸 것이다.</p>

<p>즉, p-value는 본질적으로 그 정의로부터 <strong>고정된 한 시점의 정보량만이 반영된 값</strong>이라고 할 수 있다. 이게 무슨 말이냐면, 완벽히 동일한 셋팅에서 동일한 객체들에 대해 실험을 진행한다고 하더라도 실제로 우리에게 관측되는 데이터는 시점에 따라 약간씩 차이가 있을 것이기 때문에 이를 바탕으로 계산되는 p-value는 조금씩 다를 것이라는 점이다. 따라서 빈도주의 방식에서는 “실험을 여러번 반복했을 때 잘못된 결과를 내리는 비율의 정도 (i.e. <strong>1종 오류</strong>)” 등과 같은 “상대적” 오류가 주된 관심사이다.</p>

<p> </p>

<p>그렇다면 <strong>베이지안</strong>은 어떨까?</p>

<p>베이지안 방법론에서는 <strong>“확률 변수”에 대한 통계적 추정 및 검정</strong>을 진행하게 된다. 이는 빈도주의와는 다르게 주어진 데이터를 바탕으로 “구체적인 하나의 모수값”을 추정하겠다는 것이 아니라, “해당 모수를 발생시키는 내재된 확률 과정 (i.e. <strong>통계 분포</strong>)” 을 추정하려는 것이다. 이러한 맥락에서 베이지안 방법론에서는 “<strong>사후분포 (posterior distribution)</strong>” 라고 불리는 확률 분포의 형태로 결과가 도출된다.</p>

<p>그 결과로 베이지안 방식에서는 기존의 빈도주의 방식에서 관심이 많던 <strong>1종오류 / 2종오류 / 검정력</strong> 등의 개념이 상대적으로 덜 중요하게 된다. 그 이유는 앞서 살펴본 것처럼 실험의 결과가 <strong>특정한 한 시점에서의 값</strong>이 아니라, 이러한 값들이 발생했을 만한 <strong>통계 분포</strong>이기 때문에 결과 자체에 불확실성이 자연스럽게 고려되기 때문이다.</p>

<p>가령, 베이지안에서는 <strong><em>귀무가설이 맞다는 전제 하에 ~</em></strong> // <strong><em>대립가설이 맞다는 전제 하에** ~</em> 와 같은 방식으로 논의가 전개되지 않는다. 왜냐하면 애당초 귀무가설과 대립가설 각각이 개별적인 통계 분포의 형태로 잡히기 때문에 옳고 그름을 따질 여지가 없기 때문이다. (물론 사후 분포의 형태에 대한 제약 조건이 있는 경우에는 이야기가 조금 달라질 수 있지만, 우리는 **중심 극한 정리</strong>라는 유용한 도구가 있다.)</p>

<p>그렇기 때문에 베이지안에서는 실험의 결과에 대한 해석 역시 상당히 <strong>직관적</strong>이게 된다. 예를 들어, 실험의 결과로 아래와 같이 사후 분포가 나오는 경우, A/B Test에 대해 그다지 익숙하지 않은 사람들도 한눈에 주황색 그룹에서 기대수익이 약 200원 정도 높다는 점을 파악할 수 있을 것이다. (통계학에 익숙하지 않은 사람들에게 p-value와 신뢰 구간은 편두통의 주된 원인이다..)</p>

<center>
  <img src="/images/abtest/40.png" width="350" height="300" /> 
 <br />
 <em><span style="color:grey">베이지안 A/B Test의 결과 (예시)</span></em>
</center>

<p> </p>

<p>이렇듯 베이지안 방법론은 결과 해석의 측면에서 상당히 직관적이고 편리하다는 장점을 갖고 있다.</p>

<p> </p>

<p> </p>

<hr />

<h1 id="2-베이지안-ab-test의-의사-결정-지표">2. 베이지안 A/B Test의 의사 결정 지표</h1>

<p>한편, 베이지안 A/B Test의 주된 비판점 중 하나는 바로 빈도주의 방식의 <strong>“p-value”</strong>처럼 통일된 의사 결정 기준 (decision rule) 이 확립되지 않아 실험의 결과가 다소 주관적일 수 있다는 점이었다.</p>

<p>그러나 결론부터 말하자면 이는 오해라고 할 수 있다. 베이지안 방법을 이용한 가설 검정 절차에서도 <strong>Bayes Factor</strong>라는 의사 결정 지표가 분명히 존재하며, 빈도주의의 p-value와 비슷하게 유용한 통계적 성질을 갖고 있다.</p>

<p>Bayes Factor는 수식적으로 다음과 같이 정의된다.</p>

<center>

$$
\frac{P(\text{Data} | H_1)}{P(\text{Data} | H_0)}
$$

</center>

<p> </p>

<p>즉, Bayes Factor는 어떠한 데이터가 <strong>“대립가설의 분포로부터 나왔을 확률”</strong>을 <strong>“귀무가설의 분포로부터 나왔을 확률”</strong>로 나눈 것으로 정의되는 것을 확인할 수 있는데, 이는 간단하게 말해서 우리에게 주어진 데이터가 (귀무가설에 비해) <strong>대립가설 $H1$을 지지하는 정도</strong>를 나타내는 지표라고 이해하면 된다. 이러한 맥락에서 Bayes Factor의 값이 크다는 것은 그만큼 관측된 데이터가 대립가설을 지지한다는 것을 의미하며, 반대로 0에 가까울수록 귀무가설을 지지한다고 해석할 수 있다.</p>

<p>이처럼 베이지안 가설 검정에서는 “이길 확률” 등의 다소 주관적인 지표 이외에도, Bayes Factor를 의사 결정 지표로 활용할 수 있다. 그렇다면 과연 Bayes Factor의 값이 구체적으로 얼마 정도일 때 귀무가설을 기각하게 되는지에 대해 살펴보자.</p>

<p>일반적인 빈도주의 가설 검정에서 유의 수준 $0.05$가 <strong>1종 오류를 5% 이내로 컨트롤하는 것</strong>과 비슷하게, Bayes Factor는 <strong>FDR (False Discovery Rate)</strong> 를 컨트롤 할 수 있다는 것이 알려져있다. 구체적으로, 계산된 Bayes Factor의 값이 $K$인 경우 <strong>$FDR = 1 / (K+1)$</strong> 이라는 사실이 연구되었다 (<a href="https://ieeexplore.ieee.org/document/7796910">참고</a>). 따라서 만약 Bayes Factor의 값이 19인 경우 FDR의 상한선은 5%가 된다. 일반적으로 Bayes Factor가 100을 넘어갈 경우 이는 대립가설에 대한 상당한 증거라고 판단된다.</p>

<p> </p>

<p> </p>

<hr />

<h1 id="3-베이지안-방법론의-장점">3. 베이지안 방법론의 장점</h1>

<p>앞서 살펴본 “결과 해석의 직관성”이라는 측면 이외에도, A/B Test에서 빈도주의 대비 베이지안 방식이 갖는 명확한 장점 중 하나는 바로 <strong>continuous monitoring (early stopping)</strong>에 대한 이슈가 부분적으로 해소될 수 있다는 점이다.</p>

<p>A/B Test에서 <strong>“early stopping”</strong> 이란 실험을 중도에 종료시키는 것을 의미한다. 예를 들어, 어떠한 실험이 진행되는 과정에서 유저들의 이탈율이 지속적으로 증가하는 것이 발견되었다고 해보자. 이러한 경우, 유저들의 부정적 경험을 최소화하기 위해 실험을 조기에 종료해야할 필요가 있다. 혹은 가령 약 절반 정도 진행된 실험에서 한눈에 보더라도 비교군에서의 효과가 대조군보다 더 큰 것이 확인되었다고 해보자. 이렇게 결과가 매우 명백한 것처럼 보이는 실험의 경우에 대해서도 추가적인 비용을 줄이기 위해 실험을 조기에 종료하고 싶은 니즈가 발생할 수 있다.</p>

<p>이와 관련해서 해당 <a href="https://arxiv.org/abs/1602.05549">논문</a>에서는 <strong>Bayes Factor</strong>를 의사 결정 지표로 설계된 베이지안 가설 검정 절차를 바탕으로</p>

<p>핵심적인 내용은 <strong>Bayes Factor</strong>를 decision rule로 하는 베이지안 가설 검정 절차를 사용할 경우, 몇가지의 mild한 조건만 만족된다면 실험을 조기 종료해도 문제가 발생하지 않는다는 점입니다 (수식적인 증명 과정이 궁금하시다면 앞서 첨부해드린 논문을 보시는 것을 추천드립니다).</p>

<p> </p>

<hr />

<p>&lt;/center&gt;</p>

<p> </p>

<hr />

<h1 id="reference">Reference</h1>

<ul>
  <li>A. Deng, J. Lu and S. Chen, “Continuous Monitoring of A/B Tests without Pain: Optional Stopping in Bayesian Testing,” 2016 IEEE International Conference on Data Science and Advanced Analytics (DSAA), 2016, pp. 243-252, doi: 10.1109/DSAA.2016.33.</li>
</ul>

:ET