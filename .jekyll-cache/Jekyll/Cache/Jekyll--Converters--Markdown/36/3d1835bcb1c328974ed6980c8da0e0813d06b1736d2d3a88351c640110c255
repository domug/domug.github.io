I"8<p>일반적인 A/B Test (i.e. “Fixed-Horizon Test”, “Fixed-Sample Test”) 에서는 사전에 계산된 샘플 사이즈가 충족되기 전까지 p-value를 계산하는 것이 금지된다. 그 이유는 앞서 살펴본 <a href="">다중 검정의 문제</a> 때문인데, 샘플 사이즈가 충분하지 않은 상태에서 p-value를 계산하고 이를 바탕으로 결론을 도출할 경우 family-wise type I error가 의도했던 유의 수준 $\alpha$ 를 훨씬 상회하는 문제점이 발생한다. 이를 흔히 <strong>p-hacking</strong> 이라고 부른다.</p>

<p>한편, 그럼에도 불구하고 진행되고 있는 실험을 조기에 종료하고 싶은 상황은 분명히 존재할 수 있다. 가령, 어떤 실험의 경우 control과 treatment의 차이가 너무 명확해서 실험을 끝까지 진행하는 것이 시간 낭비일 수 있다. 혹은 treatment의 새로운 기능이 user experience에 상당히 안좋은 영향을 미쳐서 실험을 더 이상 진행하는 것에 리스크가 따를 수 있다.</p>

<p>이러한 맥락에서 실험을 끝까지 진행하지 않더라도 family-wise type I error를 유의수준 이하로 컨트롤하면서 통계적으로 타당한 결론을 내릴 수 있는 방법론이 존재한다. 즉, 실험의 “early-stopping”을 지원할 수 있는 특별한 실험 디자인이 있는데, 이를 통계학에서는 “<strong>group sequential test (design)</strong>“라고 부르며, 관련해서 많은 <a href="https://scholar.google.co.kr/scholar?q=group+sequential+tests&amp;hl=ko&amp;as_sdt=0&amp;as_vis=1&amp;oi=scholart">선행 연구들</a>이 존재한다.</p>

<p>비록 해당 방법론들은 임상 통계학의 도메인에서 연구되었으나, Online A/B Test에도 자연스레 적용될 수 있으며 실제로 이와 관련한 몇가지 포스팅들이 있는 것을 찾아볼 수 있었다. (<a href="https://www.aarondefazio.com/tangentially/?p=83">참고 1</a>, <a href="https://bytepawn.com/early-stopping-in-ab-testing.html">참고 2</a>)</p>

<p>이러한 맥락에서 group sequential test의 대표적인 방법론들을 소개하고, 해당 방법론들을 사용해서 실험을 조기 종료하는 것이 어떻게 가능한지에 대해 정리해보도록 하겠다.</p>

<p> </p>

<hr />

<h1 id="1-group-sequential-tests">1. Group Sequential Tests</h1>

<p>일반적인 Fixed Horizon Test를 떠올려보자. 해당 실험에서는 실험이 종료된 다음 각 그룹별로 사전에 계산된 n개의 데이터를 바탕으로 통계분석을 수행하게 됩니다.</p>

<p>이와는 반대로 <strong>“group sequential test”</strong>는 실험이 진행되는 과정에서 “<strong>일정한 시점” 별로 누적된 데이터에 대해 분석을 수행</strong>하는 방법입니다.</p>

<p>예를 들어, 일주일 단위로 p-value를 계산한 다음 기존과 동일하게 의사결정을 내릴 수 있습니다. 만약 해당 결과가 유의하다면 (i.e. p-value &lt; 유의수준) 실험은 조기에 종료됩니다.</p>

<p>Group sequential test의 가장 핵심적인 아이디어는 만약 검정통계량이 <strong>정규분포</strong>를 따르는 경우, 여러 <strong>시점별로 false-positive의 확률을 근사적으로 계산하는 것이 가능</strong>하다는 내용입니다.</p>

<p>이처럼 각 시점별로 false-positive의 확률을 알고 있다면, 앞서 다중 검정을 처리했던 것처럼 유의수준을 보정해서 FWER을 유의수준 이하로 컨트롤 할 수 있습니다.</p>

<p>예를 들어 실험이 10일 동안 진행되고 하루를 주기로 총 10번의 중간 분석을 수행할 경우, 각 시점들에서의 false-positive 확률값들을 더한 전체 값이 0.05보다 작아질 수 있도록 각 시점마다 사용될 유의수준을 정의할 수 있습니다.</p>

<p>후술할 모든 방법론들은 모두 이러한 아이디어를 바탕으로 하고 있습니다. 아직까지는 잘 와닿지 않으실 수 있는데요, 이후 구체적인 예시를 통해서 다시 설명드리겠습니다.</p>

<p>임상시험에서 사용되는 group sequential test 중에 가장 기초적인 방법으로는 <a href="https://academic.oup.com/biomet/article-abstract/64/2/191/384776">“Pocock’s Test”</a>가 있으며, 이를 바탕으로 <a href="https://pubmed.ncbi.nlm.nih.gov/497341/">“O’Brien &amp; Flemming Test”</a> 와 <a href="https://www.jstor.org/stable/2336502?seq=1">”</a><a href="https://www.jstor.org/stable/2336502?seq=1">alpha-spending function method</a>” 가 제안되었으며 현재 가장 널리 사용되고 있습니다.</p>

<p>결론부터 말씀드리자면, A/B Test 도메인에 활용될 수 있는 방법론은 바로 마지막의 <strong>“alpha-spending function method”</strong> 입니다.</p>

<p>앞의 두가지 방법론은 group sequential test의 전체적인 맥락을 이해하시는데 도움이 될 것 같아 간략하게만 소개해드리고자 하나, 스킵하셔도 무방합니다.</p>

<p> </p>

<hr />

<center>
  <img src="/images/abtest/20.png" width="700" height="500" /> 
 <br />
 <em><span style="color:grey">Optimizely</span></em>
</center>
<p> </p>

<h2 id="reference">Reference</h2>

<ul>
  <li>https://www.aarondefazio.com/tangentially/?p=83</li>
  <li>https://bytepawn.com/early-stopping-in-ab-testing.html</li>
  <li></li>
</ul>

:ET